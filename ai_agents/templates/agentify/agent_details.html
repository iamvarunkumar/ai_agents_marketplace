{# templates/agentify/agent_detail.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}{{ agent.name }} - Agent Details{% endblock title %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-9"> {# Consistent width #}
            <div class="glass-panel mt-4 mb-4 p-4 p-md-5">

                {# Agent Header #}
                <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap"> {# Added flex-wrap #}
                    <h1 class="display-6 fw-bold mb-2 me-3">{{ agent.name }}</h1> {# Added me-3 #}

                    {# Add/Remove Buttons #}
                    <div class="agent-actions mb-2">
                        {% if user.is_authenticated %}
                            {% if in_workspace %}
                                {# Show Remove Button if agent is in workspace #}
                                <form action="{% url 'agentify:remove_from_workspace' agent_slug=agent.slug %}" method="post" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-outline-danger btn-sm">
                                        <i class="bi bi-x-lg me-1"></i> Remove from Workspace
                                    </button>
                                </form>
                            {% else %}
                                {# Show Add Button if agent is not in workspace #}
                                <form action="{% url 'agentify:add_to_workspace' agent_slug=agent.slug %}" method="post" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-success btn-sm">
                                        <i class="bi bi-plus-lg me-1"></i> Add to Workspace
                                    </button>
                                </form>
                            {% endif %}
                        {% else %}
                            {# Prompt non-logged-in users to login #}
                            <a href="{% url 'login_page' %}?next={{ request.path }}" class="btn btn-outline-primary btn-sm">Login to Add</a>
                        {% endif %}
                         {# Placeholder Run Button - Link to specific tool page if possible #}
                         <a href="{{ agent.get_absolute_url }}" class="btn btn-primary btn-sm ms-2 {% if agent.get_absolute_url == '#' %}disabled{% endif %}"><i class="bi bi-play-fill me-1"></i>Use Tool</a>
                    </div>
                </div>

                {# Agent Metadata #}
                <div class="mb-4 pb-3 border-bottom border-secondary">
                     <span class="badge me-2 {% if agent.tier == agent.TIER_PRO %}bg-success{% elif agent.tier == agent.TIER_ADVANCED %}bg-warning text-dark{% else %}bg-info text-dark{% endif %}">{{ agent.get_tier_display }}</span>
                     <span class="badge bg-secondary me-2">{{ agent.get_category_display }}</span>
                     <br class="d-sm-none"> {# Break line on small screens #}
                     <span class="small text-muted-color mt-1 mt-sm-0 d-inline-block">
                        Created by:
                        {% if agent.creator %}
                            {{ agent.creator.username|default:"Platform" }}
                        {% else %}
                            Platform
                        {% endif %}
                         on {{ agent.created_at|date:"M d, Y" }}
                    </span>
                </div>

                {# Agent Description #}
                <div class="mb-4">
                    <h3 class="h5 fw-bold mb-3">Description</h3>
                    <p class="text-muted-color">
                        {{ agent.description|default:"No detailed description provided."|linebreaksbr }}
                    </p>
                </div>

                 {# Illustration #}
                 {% if agent.illustration %}
                 <div class="mb-4 text-center">
                     <img src="{% static 'images/'|add:agent.illustration %}" alt="{{ agent.name }} Illustration" class="img-fluid rounded" style="max-height: 150px; opacity: 0.8;">
                 </div>
                 {% endif %}


                {# Placeholder Sections for Input/Output/Usage if not a specific tool page #}
                {# You might hide these if agent.get_absolute_url points to a tool page #}
                <div class="mb-4">
                    <h3 class="h5 fw-bold mb-3">Input Specification</h3>
                    <div class="glass-panel p-3 nested-panel"> {# Nested panel example #}
                        <p class="small text-muted-color mb-0"><em>Input details will be shown here.</em></p>
                    </div>
                </div>

                <div class="mb-4">
                    <h3 class="h5 fw-bold mb-3">Output Specification</h3>
                     <div class="glass-panel p-3 nested-panel">
                        <p class="small text-muted-color mb-0"><em>Output details will be shown here.</em></p>
                    </div>
                </div>

                 <div class="mb-4">
                    <h3 class="h5 fw-bold mb-3">Example Usage</h3>
                     <div class="glass-panel p-3 nested-panel">
                        <p class="small text-muted-color mb-0"><em>Usage instructions will appear here.</em></p>
                    </div>
                </div>

                {# Back Link #}
                <div class="mt-4 text-center">
                    <a href="{% url 'agentify:agent_list_basic' %}" class="btn btn-outline-secondary btn-sm">
                        <i class="bi bi-arrow-left me-1"></i> Back to Agent List
                    </a>
                </div>

            </div> {# End Main Panel #}
        </div> {# End Column #}
    </div> {# End Row #}
</div>
{% endblock content %}

{% block extra_head %}
{# Add specific CSS if needed #}
<style>
    .nested-panel {
        background-color: rgba(0,0,0, 0.15) !important; /* Darker nested panel */
        backdrop-filter: blur(5px); /* Less blur */
        -webkit-backdrop-filter: blur(5px);
        border-color: rgba(255, 255, 255, 0.1) !important;
    }
    .agent-actions form { /* Ensure forms display inline */
        margin: 0;
        display: inline-block; /* Make forms inline */
    }
</style>
{% endblock extra_head %}
